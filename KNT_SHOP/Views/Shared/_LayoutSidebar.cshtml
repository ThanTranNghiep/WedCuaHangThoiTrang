@using KNT_Shop.Models
@using Microsoft.AspNet.Identity
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>


    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewBag.Title - KNT Shop</title>
    @Styles.Render("~/Content/css")
    @Scripts.Render("~/bundles/modernizr")
    <link href="~/Content/css/layoutSidebar.css" rel="stylesheet"/>
    <script src="~/Content/js/layoutSidebar.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://kit.fontawesome.com/5e1dfe1c35.js" crossorigin="anonymous"></script>


</head>
<body class="sb-nav-fixed">
@{
    var username = User.Identity.GetUserId();
    KNT_ShopDB db = new KNT_ShopDB();
    var user = db.Users.FirstOrDefault(x => x.Id == username);

    var urlSanPham = Url.Action("SanPham", "Product");
    var urlHome = Url.Action("Index", "Home");
    var urlHoaDon = Url.Action("Index", "Invoice");
    var urlCart = Url.Action("Index", "Cart");
    var urlLogin = Url.Action("Login", "Account");
    var urlRegister = Url.Action("Register", "Account");
    var urlAdd = Url.Action("Add", "Product");
    var urlLogout = Url.Action("LogOff", "Account");
    var urlChart = Url.Action("Index", "Chart");
    var urlEditAccount = Url.Action("EditAccount", "Account");
    var urlChangePassword = Url.Action("ChangePassword", "Manage");
}
<nav class="sb-topnav navbar navbar-expand navbar-dark bg-primary">
    <!-- Navbar Brand-->
    <a class="navbar-brand ps-3" href="@urlHome">KNT Shop</a>
    <!-- Sidebar Toggle-->
    <button class="btn btn-link btn-sm order-1 order-lg-0 me-4 me-lg-0" id="sidebarToggle" href="#!">
        <i class="fas fa-bars"></i>
    </button>
    <!-- Navbar Search-->
    @* <form class="d-none d-md-inline-block form-inline ms-auto me-0 me-md-3 my-2 my-md-0"> *@
    @*     <div class="input-group"> *@
    @*         <input class="form-control" type="text" placeholder="Search for..." aria-label="Search for..." aria-describedby="btnNavbarSearch"/> *@
    @*         <button class="btn btn-primary" id="btnNavbarSearch" type="button"> *@
    @*             <i class="fas fa-search"></i> *@
    @*         </button> *@
    @*     </div> *@
    @* </form> *@

    @if (user != null && user.Rule == true)
    {
        <div class="d-none d-md-inline-block form-inline ms-auto me-0 me-md-3 my-2 my-md-0">
                <button type="button" class="btn btn-primary" onclick="Add()">
                    @* <i href="@urlCart" class="fa-solid fa-cart-shopping"></i> *@
                    <i href="@urlAdd" class="fa-solid fa-plus"></i>
                    Thêm Sản Phẩm 
                </button>
            </div>
    }
    
    <!-- Navbar Cart-->
    <div class="d-none d-md-inline-block form-inline ms-auto me-0 me-md-3 my-2 my-md-0">
        <button type="button" class="btn btn-primary" onclick="OpenCart()">
            <i href="@urlCart" class="fa-solid fa-cart-shopping"></i>
            GIỎ HÀNG
        </button>
    </div>

    @* TÀI KHOẢN ICONS *@
    <div class="navbar-nav ms-auto ms-md-0 me-3 me-lg-4">
        <button type="button" class="btn btn-primary" onclick="showLoginDialog()">
            <i class="fas fa-user fa-fw"></i>
        </button>
    </div>
</nav>
@* ============ DIALOG ============ *@
<div class="container" id="container-dialog">
    @if (username != null)
    {
        int gt = user.GioiTinh;
        string email = user.Email;
        string sdt = user.PhoneNumber;
        string diaChi = user.DiaChiNha;
        var rule = user.Rule;
        var quanHuyen = db.QuanHuyens.FirstOrDefault(x => x.MaQuan_Huyen == user.MaQuan_Huyen);
        var DateOfBirth = user.NgayThangNamSinh.ToString().Split(' ')[0];

        <dialog id="login-dialog" style="border-radius: 30px">
            <div class="mb-3 form-control">
                <label class="form-control">Tên Tài Khoản: <span>@user.Name</span> </label>
                <label class="form-control">Email: <span>@email </span> </label>
                <label class="form-control">
                    Giới Tính:
                    @{

                    }
                    @if (gt == 1)
                    {
                        <span>Nam</span>
                    }
                    else
                    {
                        <span>Nữ</span>
                    }
                </label>
                @if (@sdt != null)
                {
                    <label class="form-control">Số Điện Thoại: <span>@sdt</span> </label>
                }
                @if (@DateOfBirth != null)
                {
                    <label class="form-control">Ngày Sinh: <span>@DateOfBirth</span> </label>
                }
                @if (@quanHuyen != null)
                {
                    <label class="form-control">Quận/Huyện: <span>@quanHuyen.TenQuanHuyen</span> </label>
                }
                @if (@diaChi != null)
                {
                    <label class="form-control">Địa Chỉ: <span>@diaChi</span> </label>
                }
            </div>
            <button id="close-dialog" class="btn btn-secondary" onclick="closeLoginDialog()">Close</button>
            <button class="btn btn-success">
                <a href="@urlEditAccount" class="text-light" style="text-decoration: none">Thông tin tài khoản</a>
            </button>
            @* <buton id="logout" class="btn btn-primary" onclick="@urlLogout">Logout</buton> *@
            @using (Html.BeginForm("LogOff", "Account", FormMethod.Post, new { id = "logoutForm", @class = "btn btn-outline-danger" }))
            {
                @Html.AntiForgeryToken()
                <a class="nav-link" href="javascript:document.getElementById('logoutForm').submit()">Log off</a>
            }
        </dialog>
    }
    else
    {
        <dialog id="login-dialog">
            <div class="mb-3 form-control">
                <label class="form-control">
                    <h3>Bạn chưa đăng nhập</h3>
                </label>
            </div>
            <div class="form-control text-center">
                <button id="close-dialog" class="btn btn-secondary" onclick="closeLoginDialog()">Close</button>
                <button class="btn btn-success">
                    <a href="@urlLogin" class="text-light" style="text-decoration: none">Đăng Nhập</a>
                </button>
                <button class="btn btn-primary">
                    <a href="@urlRegister" class="text-light" style="text-decoration: none">Đăng Ký</a>
                </button>
            </div>

        </dialog>
    }

</div>
<style>
            #show-dialog {
                color: #f2f2f2;
                cursor: pointer;
            }

                #show-dialog:hover {
                    color: black;
                }
        </style>
@*===================== Dialog js ================== *@
<script src="~/Content/js/Dialog.js"></script>
@*===================== Dialog js ================== *@

<div id="layoutSidenav">
    <div id="layoutSidenav_nav">
        <nav class="sb-sidenav accordion sb-sidenav-light" id="sidenavAccordion">
            <div class="sb-sidenav-menu">
                <div class="nav">
                    <div class="sb-sidenav-menu-heading">Core</div>
                    <a class="nav-link" href="@urlHome">
                        <div class="sb-nav-link-icon">
                            @* <i class="fas fa-tachometer-alt"></i> *@
                            <i class="fa-solid fa-house"></i>
                        </div>
                        Home
                    </a>
                    <div class="sb-sidenav-menu-heading">Interface</div>
                    <a class="nav-link collapsed" href="#" data-bs-toggle="collapse" data-bs-target="#collapseLayouts" aria-expanded="false" aria-controls="collapseLayouts">
                        <div class="sb-nav-link-icon">
                            <i class="fas fa-columns"></i>
                        </div>
                        DANH MỤC
                        <div class="sb-sidenav-collapse-arrow">
                            <i class="fas fa-angle-down"></i>
                        </div>
                    </a>
                    <div class="collapse" id="collapseLayouts" aria-labelledby="headingOne" data-bs-parent="#sidenavAccordion">
                        <nav class="sb-sidenav-menu-nested nav">
                            <a class="nav-link" href="@urlSanPham">Sản phẩm</a>
                            <a class="nav-link" href="@urlHoaDon">Hoá đơn</a>
                            <a class="nav-link" href="">Hàng tồn kho</a>
                        </nav>
                    </div>
                    <a class="nav-link collapsed" href="#" data-bs-toggle="collapse" data-bs-target="#collapsePages" aria-expanded="false" aria-controls="collapsePages">
                        <div class="sb-nav-link-icon">
                            @* <i class="fas fa-book-open"></i> *@
                            <i class="fa-solid fa-gear"></i>
                        </div>
                        CÀI ĐẶT
                        <div class="sb-sidenav-collapse-arrow">
                            <i class="fas fa-angle-down"></i>
                        </div>
                    </a>
                    <div class="collapse" id="collapsePages" aria-labelledby="headingTwo" data-bs-parent="#sidenavAccordion">
                        <nav class="sb-sidenav-menu-nested nav accordion" id="sidenavAccordionPages">
                            <a class="nav-link collapsed" href="#" data-bs-toggle="collapse" data-bs-target="#pagesCollapseAuth" aria-expanded="false" aria-controls="pagesCollapseAuth">
                                <i class="fas fa-user fa-fw"></i>
                                Tài khoản
                                <div class="sb-sidenav-collapse-arrow">
                                    <i class="fas fa-angle-down"></i>
                                </div>
                            </a>
                            <div class="collapse" id="pagesCollapseAuth" aria-labelledby="headingOne" data-bs-parent="#sidenavAccordionPages">
                                <nav class="sb-sidenav-menu-nested nav">
                                    <a class="nav-link" href="@urlLogin">Login</a>
                                    <a class="nav-link" href="@urlRegister">Register</a>
                                    <a class="nav-link" href="@urlChangePassword">Reset Password</a>
                                </nav>
                            </div>
                        </nav>
                    </div>
                    <div class="sb-sidenav-menu-heading">Addons</div>
                    <a class="nav-link" href="@urlCart">
                        <div class="sb-nav-link-icon">
                            @* <i class="fas fa-table"></i> *@
                            <i class="fa-solid fa-cart-shopping"></i>
                        </div>
                        GIỎ HÀNG
                    </a>
                    <a class="nav-link" href="@urlChart">
                        <div class="sb-nav-link-icon">
                            <i class="fas fa-chart-area"></i>
                        </div>
                        Charts
                    </a>

                </div>
            </div>
            @if (username != null)
            {
                <div class="sb-sidenav-footer text-center">
                    <div class="small">Logged in as:</div>
                    <span class="text-uppercase text-primary">@user.Name</span>
                </div>
            }
            else
            {
                <div class="sb-sidenav-footer">
                    <a href="@urlLogin">Login now</a>
                </div>
            }

        </nav>
    </div>
    <div id="layoutSidenav_content">
        <main>
            <div class="container-fluid px-4">
                @RenderBody()
            </div>
        </main>
        <footer class="py-4 bg-light mt-auto">
            <div class="container-fluid px-4">
                <div class="d-flex align-items-center justify-content-between small">
                    <div class="text-muted">KNT-SHOP - SHOP THỜI TRANG NAM HÀNG ĐẦU VIỆT NAM</div>
                    <div class="text-center">
                        <a href="/Home/About">Tác Giả</a>
                    </div>
                    <div>
                        <i class="fa-brands fa-github"></i>
                        <a href="https://github.com/ThanTranNghiep/WedCuaHangThoiTrang" class="text-decoration-none text-uppercase">Source code</a>
                    </div>
                </div>
            </div>
        </footer>
    </div>
</div>
@*<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
        <script src="js/scripts.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js" crossorigin="anonymous"></script>
        <script src="assets/demo/chart-area-demo.js"></script>
        <script src="assets/demo/chart-bar-demo.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/simple-datatables@latest" crossorigin="anonymous"></script>
        <script src="js/datatables-simple-demo.js"></script>*@

@Scripts.Render("~/bundles/jquery")
@Scripts.Render("~/bundles/bootstrap")
@RenderSection("scripts", required: false)
</body>
</html>